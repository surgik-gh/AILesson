# 🗺️ Схема развертывания AILesson Platform

## Визуальная карта процесса

```mermaid
graph TD
    A[🎯 Начало] --> B[📝 Получить API ключи]
    
    B --> B1[🚀 Groq API Key<br/>console.groq.com]
    B --> B2[🤖 OpenRouter API Key<br/>openrouter.ai]
    B --> B3[✅ NextAuth Secret<br/>УЖЕ ГОТОВ!]
    
    B1 --> C[🌐 Vercel Deployment]
    B2 --> C
    B3 --> C
    
    C --> C1[Import GitHub Repo<br/>surgik-gh/AILesson]
    C1 --> C2[Root Directory:<br/>ailesson-platform]
    C2 --> C3[Добавить переменные<br/>окружения]
    C3 --> C4[🚀 Deploy]
    
    C4 --> D[🗄️ База данных]
    
    D --> D1[Вариант А:<br/>Vercel Postgres<br/>⭐ Рекомендуется]
    D --> D2[Вариант Б:<br/>Supabase<br/>🆓 Бесплатный]
    D --> D3[Вариант В:<br/>Neon<br/>📦 Текущая]
    
    D1 --> E[🔄 Обновить NEXTAUTH_URL]
    D2 --> E
    D3 --> E
    
    E --> F[🔄 Redeploy]
    
    F --> G[💾 Миграции БД]
    
    G --> G1[vercel env pull]
    G1 --> G2[prisma migrate deploy]
    G2 --> G3[prisma db seed]
    
    G3 --> H[✅ Готово!<br/>Приложение работает]
    
    style A fill:#4CAF50,color:#fff
    style H fill:#4CAF50,color:#fff
    style B3 fill:#2196F3,color:#fff
    style D1 fill:#FF9800,color:#fff
    style C4 fill:#9C27B0,color:#fff
    style F fill:#9C27B0,color:#fff
```

---

## 📊 Временная шкала

```
┌─────────────────────────────────────────────────────────────┐
│                    Общее время: ~20-30 минут                 │
└─────────────────────────────────────────────────────────────┘

📝 Получение API ключей          [████████░░] 5-10 мин
   ├─ Groq                        [███░░░░░░░] 2 мин
   ├─ OpenRouter                  [███░░░░░░░] 2 мин
   └─ NextAuth Secret             [██████████] ✅ Готов!

🌐 Vercel Deployment              [████████░░] 5-10 мин
   ├─ Import Repository           [██░░░░░░░░] 1 мин
   ├─ Настройка проекта           [███░░░░░░░] 2 мин
   ├─ Переменные окружения        [███░░░░░░░] 2 мин
   └─ Первый деплой               [████░░░░░░] 3 мин

🗄️ База данных                    [████░░░░░░] 2-5 мин
   └─ Vercel Postgres             [████░░░░░░] 2 мин
      (или Supabase)              [█████░░░░░] 3 мин

🔄 Финализация                    [█████░░░░░] 3-5 мин
   ├─ Обновить NEXTAUTH_URL       [██░░░░░░░░] 1 мин
   ├─ Redeploy                    [███░░░░░░░] 2 мин
   └─ Миграции БД                 [████░░░░░░] 2 мин

✅ Тестирование                   [███░░░░░░░] 2 мин
```

---

## 🔑 Карта переменных окружения

```
┌──────────────────────────────────────────────────────────────┐
│                  ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ                         │
└──────────────────────────────────────────────────────────────┘

🔐 Аутентификация
├─ NEXTAUTH_URL ..................... 🌐 URL приложения
│  └─ Источник: Vercel (после деплоя)
│  └─ Пример: https://ailesson-abc123.vercel.app
│
└─ NEXTAUTH_SECRET .................. 🔑 Секретный ключ
   └─ Источник: ✅ УЖЕ ГОТОВ!
   └─ Значение: 3ivwX0knmak41v6l7asbqmkHkkpXUZkdWOOL92CO0HQ=

🗄️ База данных
└─ DATABASE_URL ..................... 🐘 PostgreSQL
   ├─ Вариант А: Vercel Postgres (автоматически)
   ├─ Вариант Б: Supabase (supabase.com)
   └─ Вариант В: Neon (текущая база)

🤖 AI Сервисы
├─ GROQ_API_KEY ..................... 🚀 Генерация уроков
│  └─ Источник: console.groq.com
│  └─ Формат: gsk_...
│
└─ OPENROUTER_API_KEY ............... 🧠 AI эксперты
   └─ Источник: openrouter.ai
   └─ Формат: sk-or-v1-...

⚙️ Конфигурация
├─ CHAT_COST_PER_MESSAGE ............ 💰 Стоимость сообщения
│  └─ Значение: 5
│
├─ MAX_FILE_SIZE_MB ................. 📦 Макс. размер файла
│  └─ Значение: 50
│
└─ ALLOWED_FILE_TYPES ............... 📄 Типы файлов
   └─ Значение: pdf,png,jpg,jpeg,txt
```

---

## 🎯 Критический путь (минимум для запуска)

```
1. NEXTAUTH_SECRET ✅ (готов)
2. GROQ_API_KEY 🚀 (обязательно)
3. OPENROUTER_API_KEY 🤖 (обязательно)
4. DATABASE_URL 🗄️ (обязательно)
5. NEXTAUTH_URL 🌐 (после деплоя)
```

**Без этих переменных приложение не запустится!**

---

## 🔄 Процесс обновления после изменений

```mermaid
graph LR
    A[Изменения в коде] --> B[Git Push]
    B --> C[Vercel Auto-Deploy]
    C --> D[Новая версия live]
    
    E[Изменения в БД] --> F[Создать миграцию]
    F --> G[prisma migrate deploy]
    G --> H[БД обновлена]
    
    style C fill:#9C27B0,color:#fff
    style G fill:#FF9800,color:#fff
```

---

## 📱 Архитектура развернутого приложения

```
┌─────────────────────────────────────────────────────────────┐
│                         ПОЛЬЗОВАТЕЛЬ                         │
└────────────────────────┬────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────┐
│                    VERCEL (Edge Network)                     │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              Next.js Application                      │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐     │   │
│  │  │   Pages    │  │    API     │  │   Static   │     │   │
│  │  │  (React)   │  │   Routes   │  │   Assets   │     │   │
│  │  └────────────┘  └────────────┘  └────────────┘     │   │
│  └──────────────────────────────────────────────────────┘   │
└────────────────────────┬────────────────────────────────────┘
                         │
         ┌───────────────┼───────────────┐
         │               │               │
         ▼               ▼               ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  PostgreSQL │  │    Groq     │  │ OpenRouter  │
│   Database  │  │   AI API    │  │   AI API    │
│             │  │             │  │             │
│ (Vercel/    │  │ (Lessons &  │  │ (AI Expert  │
│  Supabase/  │  │   Quizzes)  │  │ Generation) │
│   Neon)     │  │             │  │             │
└─────────────┘  └─────────────┘  └─────────────┘
```

---

## 🎉 Результат

После завершения всех шагов у вас будет:

✅ Работающее приложение на Vercel  
✅ База данных PostgreSQL  
✅ AI-генерация уроков (Groq)  
✅ AI-эксперты (OpenRouter)  
✅ Система аутентификации (NextAuth)  
✅ Автоматические деплои при push в GitHub  

**URL приложения:** `https://ваш-проект.vercel.app`

---

## 📚 Следующие шаги

1. **Custom Domain** - подключите свой домен
2. **Monitoring** - настройте мониторинг ошибок
3. **Analytics** - добавьте аналитику
4. **Backup** - настройте бэкапы БД
5. **CI/CD** - настройте автотесты перед деплоем
